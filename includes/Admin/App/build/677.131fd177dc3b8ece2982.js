"use strict";(self.webpackChunk_burst_statistics_burst_statistics=self.webpackChunk_burst_statistics_burst_statistics||[]).push([[677],{3316(e,t,r){r.d(t,{A:()=>s});var n=r(10790),o=r(51609),i=function(){return i=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},i.apply(this,arguments)},a=(0,o.forwardRef)(function(e,t){var r=e.type,o=void 0===r?"text":r,a=e.className,s=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r}(e,["type","className"]);return(0,n.jsx)("input",i({ref:t,type:o,className:"w-full rounded-md border border-gray-400 p-2 focus:border-primary-dark focus:outline-none focus:ring disabled:cursor-not-allowed disabled:border-gray-200 disabled:bg-gray-200 ".concat(a||"")},s))});a.displayName="TextInput";const s=a},45989(e,t,r){r.d(t,{H:()=>u});var n=r(10790),o=r(51609),i=r(27723),a=r(47515),s=r(3316),c=r(92745),u=function(e){var t=e.reportBlockIndex,r=e.isEditingMode,u=void 0!==r&&r,l=(0,a.c)(function(e){return e.updateCommentTitle}),d=(0,a.c)(function(e){return e.updateCommentText}),f=(0,a.c)(function(e){var r,n;return null!==(n=null===(r=e.wizard.content[t])||void 0===r?void 0:r.comment_title)&&void 0!==n?n:""}),p=(0,a.c)(function(e){var r,n;return null!==(n=null===(r=e.wizard.content[t])||void 0===r?void 0:r.comment_text)&&void 0!==n?n:""}),h=f||p,m=(0,o.useRef)(null),v=(0,o.useState)(!!h),b=v[0],y=v[1];return u||p||f?u?b||h?(0,n.jsxs)("div",{className:"p-4 rounded-xl bg-white shadow-sm relative border border-gray-300 w-full",children:[(0,n.jsx)("div",{className:"mb-3",children:(0,n.jsx)(s.A,{value:f||"",onChange:function(e){return l(t,e.target.value)},placeholder:(0,i.__)("Comment title (optional)","burst-statistics"),className:"text-sm font-semibold"})}),(0,n.jsx)("div",{children:(0,n.jsx)("textarea",{value:p||"",ref:m,onChange:function(e){return d(t,e.target.value)},placeholder:(0,i.__)("Add your insights or comments about this data...","burst-statistics"),className:"w-full min-h-[100px] p-2 text-sm text-gray-600 border border-gray-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-y",rows:4})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 mt-2",children:[(0,n.jsx)("p",{className:"text-xs text-gray-500",children:(0,i.__)("This comment will appear next to the block in the report. If there is not enough space, the comment will be shown below the block.","burst-statistics")}),(0,n.jsxs)("button",{onClick:function(){return y(!1),l(t,""),void d(t,"")},className:"ml-auto text-xs text-gray-600 hover:text-gray-700 bg-gray-50 border border-gray-300 rounded-md p-1 hover:bg-gray-100 hover:border-gray-400 transition-colors duration-200 whitespace-nowrap flex items-center gap-1",children:[(0,n.jsx)(c.A,{name:"trash",size:13,className:"opacity-50"}),(0,i.__)("Remove comment","burst-statistics")]})]})]}):(0,n.jsxs)("button",{onClick:function(){return y(!0)},className:"w-full p-4 rounded-xl bg-wp-gray shadow-sm border border-gray-300 hover:border-gray-400 hover:bg-white transition-colors duration-200 flex items-center justify-center gap-2 text-gray-600 hover:text-gray-800",children:[(0,n.jsx)(c.A,{name:"plus",size:16}),(0,n.jsx)("span",{className:"text-sm font-medium",children:(0,i.__)("Add comment","burst-statistics")})]}):(0,n.jsxs)("div",{className:"p-4 rounded-xl bg-white shadow-sm relative border border-gray-300 w-full",children:[f&&(0,n.jsx)("p",{className:"text-gray-700 text-sm font-semibold mb-2",children:f}),p&&(0,n.jsx)("p",{className:"text-gray-600 text-sm whitespace-pre-wrap",children:p})]}):null}},50863(e,t,r){r.d(t,{_:()=>p});var n=r(30346),o=r(47515),i=r(28811),a=r(27723),s=r(21587),c=function(){return c=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},c.apply(this,arguments)},u=function(e,t,r,n){return new(r||(r=Promise))(function(o,i){function a(e){try{c(n.next(e))}catch(e){i(e)}}function s(e){try{c(n.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r(function(e){e(t)})).then(a,s)}c((n=n.apply(e,t||[])).next())})},l=function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}},d=function(e,t,r){if(r||2===arguments.length)for(var n,o=0,i=t.length;o<i;o++)!n&&o in t||(n||(n=Array.prototype.slice.call(t,0,o)),n[o]=t[o]);return e.concat(n||Array.prototype.slice.call(t))},f={can_change_date:!1,can_filter:!1},p=(0,n.v)(function(e,t){return{reports:[],expiration:"7d",permissions:f,isGenerating:!1,setIsGenerating:function(t){return e({isGenerating:t})},setReports:function(t){return e({reports:t})},openPreview:function(e,r){return u(void 0,void 0,void 0,function(){var n,o,i;return l(this,function(a){switch(a.label){case 0:return n=window.open("about:blank","_blank"),[4,t().generateStoryUrl(e)];case 1:return(o=a.sent())?(i=r?"&autoprint=1":"",o=o.replace(/\?burst_share_token=/,"?pdf=1".concat(i,"&burst_share_token=")),n&&(n.location.href=o),[2]):(null==n||n.close(),console.error("Failed to create story URL"),s.oR.error("Failed to create story URL"),[2])}})})},generateStoryUrl:function(e){return u(void 0,void 0,void 0,function(){var r,n,c,u,d,f,p;return l(this,function(l){switch(l.label){case 0:t().setIsGenerating(!0),r="",l.label=1;case 1:return l.trys.push([1,6,7,8]),n=window.location.href,c=n.replace(/wp-admin\/admin\.php\?page=burst.*/,"burst-dashboard#/story"),o.c.getState().wizard.id!==e?[3,3]:[4,t().saveReportFromWizard()];case 2:return l.sent(),[3,4];case 3:t().loadReportIntoWizard(e,!1),l.label=4;case 4:return u=t().permissions,d=t().expiration,[4,(0,i.Eo)("get_share_token",{expiration:d,view_url:c,permissions:u,shared_tabs:"",report_id:e,initial_state:{}})];case 5:return(f=l.sent()).share_token&&f.share_url?(r=f.share_url,[3,8]):(s.oR.error((0,a.__)("Failed to generate share link","burst-statistics")),[2,""]);case 6:return p=l.sent(),console.error("Failed to generate share link:",p),s.oR.error((0,a.__)("Failed to generate share link","burst-statistics")),[3,8];case 7:return t().setIsGenerating(!1),[7];case 8:return[2,r]}})})},saveReportFromWizard:function(){return u(void 0,void 0,void 0,function(){var e,r,n;return l(this,function(i){switch(i.label){case 0:return(e=o.c.getState().wizard).id?(r=t().reports.find(function(t){return t.id===e.id}))?(n={},r.name!==e.name&&(n.name=e.name),r.format!==e.format&&(n.format=e.format),r.scheduled!==e.scheduled&&(n.scheduled=e.scheduled),r.frequency!==e.frequency&&(n.frequency=e.frequency),r.dayOfWeek!==e.dayOfWeek&&(n.dayOfWeek=e.dayOfWeek),r.weekOfMonth!==e.weekOfMonth&&(n.weekOfMonth=e.weekOfMonth),r.sendTime!==e.sendTime&&(n.sendTime=e.sendTime),r.fixedEndDate!==e.fixedEndDate&&(n.fixedEndDate=e.fixedEndDate),r.reportDateRange!==e.reportDateRange&&(n.reportDateRange=e.reportDateRange),r.content.length===e.content.length&&r.content.every(function(t,r){return t===e.content[r]})||(n.content=d([],e.content,!0)),r.recipients.length===e.recipients.length&&r.recipients.every(function(t,r){return t===e.recipients[r]})||(n.recipients=d([],e.recipients,!0)),0===Object.keys(n).length?[2,r]:[4,t().updateReport(e.id,n)]):[2,!1]:[3,2];case 1:case 3:return[2,i.sent()];case 2:return[4,t().createReport({name:e.name,format:e.format,enabled:!1,content:d([],e.content,!0),recipients:d([],e.recipients,!0),scheduled:e.scheduled,frequency:e.frequency,dayOfWeek:e.dayOfWeek,weekOfMonth:e.weekOfMonth,sendTime:e.sendTime,fixedEndDate:e.fixedEndDate,reportDateRange:e.reportDateRange})]}})})},loadReportIntoWizard:function(e,r){var n=o.c.getState().wizard.currentStep,i=t().reports.find(function(t){return t.id===e});return!!i&&(o.c.setState({wizard:{id:i.id,currentStep:n,name:i.name,reportDateRange:i.reportDateRange,format:i.format,content:i.content,recipients:d([],i.recipients,!0),scheduled:i.scheduled,frequency:i.frequency,dayOfWeek:i.dayOfWeek,weekOfMonth:i.weekOfMonth,sendTime:i.sendTime,fixedEndDate:i.fixedEndDate||""},isOpen:r}),!0)},updateReport:function(t,r){return u(void 0,void 0,void 0,function(){var n;return l(this,function(o){switch(o.label){case 0:return r.id=t,[4,(0,i.Eo)("report/update",r)];case 1:return(n=o.sent()).success&&n.report?(e(function(e){return{reports:e.reports.map(function(e){return e.id===t?c({},n.report):e})}}),[2,n.report]):[2,!1]}})})},deleteReport:function(t){return u(void 0,void 0,void 0,function(){return l(this,function(r){switch(r.label){case 0:return[4,(0,i.Eo)("report/delete",{id:t})];case 1:return r.sent().success?(e(function(e){return{reports:e.reports.filter(function(e){return e.id!==t})}}),[2,!0]):[2,!1]}})})},duplicateReport:function(e){return u(void 0,void 0,void 0,function(){var r,n,o,i;return l(this,function(s){switch(s.label){case 0:return(r=t().reports.find(function(t){return t.id===e}))?(n=(0,a.__)("Copy","burst-statistics"),o="(".concat(n,")"),i=r.name.trimEnd().endsWith(o)?r.name:"".concat(r.name," ").concat(o),[4,t().createReport(c(c({},r),{id:void 0,name:i}))]):[2,!1];case 1:return[2,s.sent()]}})})},duplicateAndLoadReportIntoWizard:function(e){return u(void 0,void 0,void 0,function(){var r;return l(this,function(n){switch(n.label){case 0:return[4,t().duplicateReport(e)];case 1:return(r=n.sent())&&t().loadReportIntoWizard(r.id,!0)?(o.c.getState().setCurrentStep(4),[2,r]):[2,!1]}})})},toggleReportActive:function(e){return u(void 0,void 0,void 0,function(){var r,n;return l(this,function(o){switch(o.label){case 0:return(r=t().reports.find(function(t){return t.id===e}))?(n={enabled:!r.enabled},[4,t().updateReport(e,n)]):[2];case 1:return o.sent(),[2]}})})},createReport:function(r){return u(void 0,void 0,void 0,function(){var n,o;return l(this,function(a){switch(a.label){case 0:return[4,(0,i.Eo)("report/create",r)];case 1:return(null==(n=a.sent())?void 0:n.success)&&(null==n?void 0:n.report)?(o=n.report.id,e(function(e){return{reports:d([n.report],e.reports,!0)}}),t().loadReportIntoWizard(o,!0),[2,n.report]):[2,!1]}})})},sendTestEmail:function(e){return u(void 0,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return[4,(0,i.Eo)("report/send-test-report",{id:e})];case 1:return[2,t.sent().success]}})})},sendEmailNow:function(e){return u(void 0,void 0,void 0,function(){return l(this,function(t){switch(t.label){case 0:return[4,(0,i.Eo)("report/send-report-now",{id:e})];case 1:return[2,t.sent().success]}})})}}})},75677(e,t,r){r.r(t),r.d(t,{component:()=>b});var n=r(10790),o=r(28811),i=r(61626),a=r(51609),s=r.n(a),c=r(45989),u=function(e){var t=e.children,r=e.reportBlockIndex;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"mb-4 grid grid-cols-1 md:grid-cols-12 gap-2 mx-auto w-full",children:[(0,n.jsx)("div",{className:"md:col-span-7",children:(0,n.jsx)("div",{className:"group relative p-2 border border-transparent",children:t})}),(0,n.jsx)("div",{className:"md:col-span-5 flex flex-row items-end gap-2 p-2",children:(0,n.jsx)(c.H,{reportBlockIndex:r,isEditingMode:!1})})]})})},l=r(15672),d=r(47515),f=r(92745),p=r(50863),h=r(63557),m=r(27723),v=function(){return v=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},v.apply(this,arguments)};function b(){var e=this,t=s().useState(!1),r=t[0],c=t[1],b=(0,h.A)(function(e){return e.isPdfMode}),y=(0,l.z)(function(e){return e.availableContent}),g=(0,d.c)(function(e){return e.getStartDate}),w=(0,d.c)(function(e){return e.getEndDate}),x=(0,d.c)(function(e){return e.wizard.content}),k=(0,p._)(function(e){return e.setReports}),_=(0,p._)(function(e){return e.loadReportIntoWizard}),j=function(){return t=e,r=void 0,i=function(){var e,t;return function(e,t){var r,n,o,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(c){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,n=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}(this,function(r){return e=new URLSearchParams(window.location.search).get("burst_share_token"),t={token:e},[2,(0,o.Eo)("report/data",t)]})},new((n=void 0)||(n=Promise))(function(e,o){function a(e){try{c(i.next(e))}catch(e){o(e)}}function s(e){try{c(i.throw(e))}catch(e){o(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof n?r:new n(function(e){e(r)})).then(a,s)}c((i=i.apply(t,r||[])).next())});var t,r,n,i},O=(0,i.I)({queryKey:["report-data"],queryFn:function(){return j()}}),R=O.data,E=O.isFetching,N=O.isError;return(0,a.useEffect)(function(){(null==R?void 0:R.report)&&(k([R.report]),_(R.report.id,!1),c(!0))},[null==R?void 0:R.report,k,_]),(0,a.useEffect)(function(){if("1"===new URLSearchParams(window.location.search).get("autoprint")){var e=setTimeout(function(){window.print()},1e3);return function(){return clearTimeout(e)}}},[x]),!E&&!N&&r&&(null==R?void 0:R.report)&&Array.isArray(x)&&0!==x.length?R.report.id?(0,n.jsxs)("div",{className:"col-span-12 flex flex-col",children:[b&&(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsxs)("button",{onClick:function(){window.print()},className:" print:hidden flex items-center gap-2 px-4 py-2 bg-white border border-gray-300 hover:border-gray-400 text-gray-700 hover:text-gray-900 font-medium rounded-lg shadow-sm hover:shadow transition-all duration-200",children:[(0,n.jsx)(f.A,{name:"download",size:18}),(0,n.jsx)("span",{children:(0,m.__)("Download PDF","burst-statistics")})]})}),x.map(function(e,t){var r,o=e.id,i=y.find(function(e){return e.id===o});if(!i||!i.component)return console.warn("Block config not found for blockId: ".concat(o)),null;var a=i.component,s=v(v({customFilters:null!==(r=e.filters)&&void 0!==r?r:{},reportBlockIndex:t,startDate:g(t),endDate:w(t)},(null==i?void 0:i.blockProps)||{}),{allowBlockFilters:!1,isReport:!0});return(0,n.jsx)(u,{reportBlockIndex:t,children:(0,n.jsx)(a,v({},s))},"".concat(o,"-").concat(t))})]}):null:(0,n.jsx)("div",{className:"col-span-12 flex justify-center items-center p-8",children:(0,n.jsx)(f.A,{name:"loading",color:"gray"})})}}}]);